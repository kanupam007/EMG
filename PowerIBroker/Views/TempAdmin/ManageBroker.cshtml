@using PowerIBrokerDataLayer
@using PowerIBrokerBusinessLayer
@using PowerIBroker.Areas.Broker.Models
@{
    PowerIBrokerEntities context = new PowerIBrokerEntities();
    CommonMasters cmm = new CommonMasters();
    Comman objComman = new Comman();
    ViewBag.Title = "Add Broker";
    Layout = "~/Views/Shared/_Admin.cshtml";
    var CompanyData = context.tblBrokers.Where(x => x.IsActive.Value).ToList();


}

<script src="https://unpkg.com/jquery-input-mask-phone-number@1.0.15/dist/jquery-input-mask-phone-number.js"></script>
<style>
    .slim-pageheader {
        padding-top: 30px;
    }
</style>
<div class="container">
    <div class="slim-pageheader" style="padding-top: 25px !important;">
        <ol class="breadcrumb slim-breadcrumb">
            <li class="breadcrumb-item"><a href="/Super-Admin">Admin</a></li>
            <li class="breadcrumb-item active" aria-current="page">Create Broker Company</li>
        </ol>
        <h6 class="slim-pagetitle">Create Broker Company</h6>
    </div><!-- slim-pageheader -->




    <div class="section-wrapper">
        <div class="row">
            <div class="col-lg-6">
                <label class="section-title">Broker Company</label>
            </div>

        </div>

        <div class="form-layout">
            <div class="row mg-b-25">
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label">Broker Number: </label>
                        <input type="text" class="form-control" id="txtCustomerNumber" value="" maxlength="15">
                        <ul class="parsley-errors-list filled" id="parsley-txtCustomerNumber"><li class="parsley-required">This value is required.</li></ul>
                    </div>
                </div><!-- col-4 -->
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label">Company Name: <span class="tx-danger">*</span></label>
                        <input type="text" class="form-control" id="txtCompanyName" value="" maxlength="50">
                        <ul class="parsley-errors-list filled" id="parsley-txtCompanyName"><li class="parsley-required">This value is required.</li></ul>
                    </div>
                </div><!-- col-4 -->
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label">Work Phone: <span class="tx-danger">*</span></label>
                        <input type="text" class="form-control mask" id="txtWorkPhone" maxlength="15" onkeypress="return isNumberKey(event);" value="">
                        <ul class="parsley-errors-list filled" id="parsley-txtWorkPhone"><li class="parsley-required">This value is required.</li></ul>
                    </div>
                </div>

                <!-- col-4 -->

            </div>
            <div class="row mg-b-25">
                <!-- col-4 -->
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label">Street: <span class="tx-danger">*</span></label>
                        <textarea rows="2" class="form-control" id="txtStreetName"></textarea>
                        <ul class="parsley-errors-list filled" id="parsley-txtStreetName"><li class="parsley-required">This value is required.</li></ul>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label">City: <span class="tx-danger">*</span></label>
                        <input type="text" class="form-control" id="txtCityName" maxlength="30" value="">
                        <ul class="parsley-errors-list filled" id="parsley-txtCityName"><li class="parsley-required">This value is required.</li></ul>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="form-control-label">State: <span class="tx-danger">*</span></label>
                        <select class="form-control select2-show-search company-information" valuedata="" id="txtStateName" data-placeholder="Choose State">
                            <option value="">Select State</option>
                            <option value="AL">Alabama</option>
                            <option value="AK">Alaska</option>
                            <option value="AZ">Arizona</option>
                            <option value="AR">Arkansas</option>
                            <option value="CA">California</option>
                            <option value="CO">Colorado</option>
                            <option value="CT">Connecticut</option>
                            <option value="DE">Delaware</option>
                            <option value="FL">Florida</option>
                            <option value="GA">Georgia</option>
                            <option value="HI">Hawaii</option>
                            <option value="ID">Idaho</option>
                            <option value="IL">Illinois</option>
                            <option value="IN">Indiana</option>
                            <option value="IA">Iowa</option>
                            <option value="KS">Kansas</option>
                            <option value="KY">Kentucky</option>
                            <option value="LA">Louisiana</option>
                            <option value="ME">Maine</option>
                            <option value="MD">Maryland</option>
                            <option value="MA">Massachusetts</option>
                            <option value="MI">Michigan</option>
                            <option value="MN">Minnesota</option>
                            <option value="MS">Mississippi</option>
                            <option value="MO">Missouri</option>
                            <option value="MT">Montana</option>
                            <option value="NE">Nebraska</option>
                            <option value="NV">Nevada</option>
                            <option value="NH">New Hampshire</option>
                            <option value="NJ">New Jersey</option>
                            <option value="NM">New Mexico</option>
                            <option value="NY">New York</option>
                            <option value="NC">North Carolina</option>
                            <option value="ND">North Dakota</option>
                            <option value="OH">Ohio</option>
                            <option value="OK">Oklahoma</option>
                            <option value="OR">Oregon</option>
                            <option value="PA">Pennsylvania</option>
                            <option value="RI">Rhode Island</option>
                            <option value="SC">South Carolina</option>
                            <option value="SD">South Dakota</option>
                            <option value="TN">Tennessee</option>
                            <option value="TX">Texas</option>
                            <option value="UT">Utah</option>
                            <option value="VT">Vermont</option>
                            <option value="VA">Virginia</option>
                            <option value="WA">Washington</option>
                            <option value="DC">Washington, D.C.(DC)</option>
                            <option value="WV">West Virginia</option>
                            <option value="WI">Wisconsin</option>
                            <option value="WY">Wyoming</option>
                        </select>
                        <ul class="parsley-errors-list filled" id="parsley-txtStateName"><li class="parsley-required">This value is required.</li></ul>
                    </div>
                </div><!-- col-4 -->
                <!-- col-4 -->

            </div>
            <div class="row mg-b-25">
                <!-- col-4 -->
                <div class="col-lg-4">
                    <div class="form-group">
                        <label class="col-sm-4 form-control-label">Zip Code: <span class="tx-danger">*</span></label>
                        <input type="text" class="form-control" id="txtZipCode" onkeypress="return isNumberKey(event);" onchange="validateZipCode($(this).attr('id'));" maxlength="5" value="">
                        <ul class="parsley-errors-list filled" id="parsley-txtZipCode"><li class="parsley-required">This value is required.</li></ul>
                        <ul class="parsley-errors-list filled" id="parsley-Zip-txtZipCode"><li class="parsley-required">Zip code is not valid.</li></ul>
                    </div>
                </div>



            </div>
            <button class="btn btn-primary bd-0 btnclient" id="btnclientsubmit" url="/GeneralAgent/UpdateClient">Add</button>
            <button class="btn btn-secondary bd-0 btnclient" onclick="ResetClient();">Cancel</button>

        </div>
        <div class="table-responsive mg-t-25" id="brokerdata">
            <table class="table mg-b-0 datatable">
                <thead>
                    <tr>
                        <th class="wd-30p">Company name</th>
                        <th class="wd-15p">Broker Number</th>
                        <th class="wd-12p">Work-Phone</th>
                        <th class="wd-12p">Mobile</th>
                        <th class="wd-30p" style="text-align:center;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in CompanyData)
                    {
                    <tr>
                        <td>@item.Broker</td>
                        <td>@(string.IsNullOrEmpty(item.BrokerNumber)?"-------":item.BrokerNumber) </td>
                        <td>@(string.IsNullOrEmpty(item.WorkPhone) ?"-------": objComman.AddMasking(item.WorkPhone))</td>
                        <td> @(string.IsNullOrEmpty(item.Phone) ?"-------": objComman.AddMasking(item.Phone))</td>

                        <td>
                            <a style="margin-bottom: 2px;" onclick="CompanyEdit('@item.BrokerNumber', '@item.Broker', '@(objComman.AddMasking(item.WorkPhone))', '@item.City', '@(context.StateMasters.Where(x=>x.ID==item.State).Count()>0?context.StateMasters.Where(x=>x.ID==item.State).FirstOrDefault().State:"")', '@item.ZipCode', '@item.Street');" class="btn btn-primary btn-xs editSubBroker">Edit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
                            <a href="javascript:void(0)" status="@item.IsActive.ToString()" style="margin-bottom: 2px;" onclick="BrokerActivateSuspend(this);" class="btn btn-outline-@(item.IsActive.Value ? "danger":"primary")  btn-xs SubBrokerStatus">@(item.IsActive.Value ? "Suspend":"Activate")</a>
                            <a href="javascript:void(0)" style="margin-bottom: 2px;" onclick="BrokerDelete(this);" class="btn btn-outline-danger btn-xs SubBrokerDeactivate">Delete&nbsp;&nbsp;&nbsp;&nbsp;</a>
                        </td>
                    </tr>
                    }

                </tbody>
            </table>

        </div>

    </div>
    <div class="section-wrapper mg-t-25" id="scrolltop">
        <div id="MainAdmin">
            <div id="ClientAdmin1">
                <div class="row">
                    <div class="col-lg-6">
                        <label class="section-title">Broker User</label>
                    </div>

                </div>

                <div class="form-layout">
                    <div class="row mg-b-25">
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label">Company Name: <span class="tx-danger">*</span></label>
                                <select class="form-control administrator" id="ddlAdAdministratorType1">
                                    <option value="">Choose Company</option>
                                    @foreach (var item in CompanyData)
                                    {
                                        <option value="@item.BrokerId">@item.Broker</option>

                                    }

                                </select>
                                <ul class="parsley-errors-list filled" id="parsley-ddlAdAdministratorType1"><li class="parsley-required">This value is required.</li></ul>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label">Firstname: <span class="tx-danger">*</span></label>
                                <input class="form-control" type="text" name="firstname" id="txtAdFirstName1" maxlength="20" onkeypress="">
                                <ul class="parsley-errors-list filled" id="parsley-txtAdFirstName1"><li class="parsley-required">This value is required.</li></ul>
                            </div>
                        </div><!-- col-4 -->
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label">Lastname: <span class="tx-danger">*</span></label>
                                <input class="form-control" type="text" name="lastname" id="txtAdLastName1" onkeypress="">
                                <ul class="parsley-errors-list filled" id="parsley-txtAdLastName1"><li class="parsley-required">This value is required.</li></ul>
                            </div>
                        </div><!-- col-4 -->
                        <!-- col-4 -->

                    </div>
                    <div class="row mg-b-25">
                        <!-- col-4 -->
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label">Email address: <span class="tx-danger">*</span></label>
                                <input class="form-control" type="text" name="email" id="txtAdEmail1">
                                <ul class="parsley-errors-list filled" id="parsley-txtAdEmail1"><li class="parsley-required">This value is required.</li></ul>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label">Work Phone: <span class="tx-danger">*</span></label>
                                <input class="form-control mask" type="text" name="lastname" id="txtAdWorkPhone1" onkeypress="return isNumberKey(event);" maxlength="15">
                                <ul class="parsley-errors-list filled" id="parsley-txtAdWorkPhone1"><li class="parsley-required">This value is required.</li></ul>
                            </div>
                        </div><!-- col-4 -->
                        <div class="col-lg-4">
                            <div class="form-group">
                                <label class="form-control-label">Mobile: <span class="tx-danger">*</span></label>
                                <input class="form-control mask" type="text" name="email" id="txtAdMobile1" maxlength="15" onkeypress="return isNumberKey(event);">
                                <ul class="parsley-errors-list filled" id="parsley-txtAdMobile1"><li class="parsley-required">This value is required.</li></ul>
                            </div>
                        </div><!-- col-4 -->

                    </div>
                    <button class="btn btn-primary bd-0 btnclient" id="btnclientsubmit1" url="/Broker-Admin/UpdateClient">Add</button>
                    <button class="btn btn-secondary bd-0 btnclient" onclick="ResetClient();">Cancel</button>

                </div>
                <div class="table-responsive mg-t-25" id="brokerdata">
                    <table class="table mg-b-0 datatable">
                        <thead>
                            <tr>
                                <th class="wd-20p">First name</th>
                                <th class="wd-15p">Last name</th>
                                <th class="wd-15p">Email</th>
                                <th class="wd-15p">Work-Phone</th>
                                <th class="wd-35p" style="text-align:center;">Action</th>

                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in context.tblSubBrokers.Where(x=>x.IsActive.Value))
                            {
                            <tr>
                                <td>@item.FirstName</td>
                                <td>@item.LastName</td>
                                <td>@item.Email</td>
                                <td>@objComman.AddMasking(item.WorkPhone)</td>
                                <td>
                                    <a style="margin-bottom: 2px;" onclick="GAUSerEdit('@item.SubBrokerId', '@item.FirstName', '@item.LastName', '@item.Email', '@(objComman.AddMasking(item.WorkPhone))', '@(objComman.AddMasking(item.Phone))');" class="btn btn-primary btn-xs editSubBroker">Edit&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
                                    <a href="javascript:void(0)" status="@item.IsActive.ToString()" style="margin-bottom: 2px;" onclick="BrokerActivateSuspend(this);" class="btn btn-outline-@(item.IsActive.Value ? "danger":"primary")  btn-xs SubBrokerStatus">@(item.IsActive.Value ? "Suspend":"Activate")</a>
                                    <a href="javascript:void(0)" style="margin-bottom: 2px;" onclick="BrokerDelete(this);" class="btn btn-outline-danger btn-xs SubBrokerDeactivate">Delete&nbsp;&nbsp;&nbsp;&nbsp;</a>
                                </td>

                            </tr>
                            }

                        </tbody>
                    </table>

                </div>
            </div>



        </div>

    </div>



</div>


<script>
    $(document).ready(function () {
        $('.mask').usPhoneFormat({
            format: '(xxx) xxx-xxxx',
        });


    });

    function BrokerActivateSuspend(sender) {
        var status = $(sender).attr('status').toLowerCase();
        newmsg = (status == "true" ? "Activate" : "Suspend");
        swal({
            title: "",
            text: "Do you want to " + $(sender).text() + " the Broker user?",
            //type: "warning",
            showCancelButton: true,
            confirmButtonClass: "#f27474",
            confirmButtonText: $(sender).text(),
            cancelButtonText: "Cancel",
            closeOnConfirm: true,
            closeOnCancel: true
        },
            function (isConfirm) {

                if (isConfirm) {
                    ShowAlert('Success', 'Status updated successfully', 'success');
                    $(sender).text(newmsg);
                    $(sender).attr('status', status == "true" ? false : true);
                    if (newmsg == "Activate") {
                        $(sender).removeClass("btn-outline-danger");
                        $(sender).addClass("btn-outline-primary");
                    }
                    else {
                        $(sender).addClass("btn-outline-danger");
                        $(sender).removeClass("btn-outline-primary");
                    }

                }

            });
    }
    function BrokerDelete(sender) {
        swal({
            title: "",
            text: "Do you want to remove the Broker user?",
            //type: "warning",
            showCancelButton: true,
            confirmButtonClass: "#f27474",
            confirmButtonText: "Remove",
            cancelButtonText: "Cancel",
            closeOnConfirm: true,
            closeOnCancel: true
        },
            function (isConfirm) {

                if (isConfirm) {
                    ShowAlert('Success', 'Broker user deleted successfully', 'success');
                    $(sender).parent().parent().remove();

                }

            });
    }
    function CompanyEdit(BrokerNumber, CompanyName, WorkPhone, City, State, ZipCode, Street) {
        $('#txtCustomerNumber').val(BrokerNumber);
        $('#txtCompanyName').val(CompanyName);
        $('#txtWorkPhone').val(WorkPhone);
        $('#txtCityName').val(City);
        $('#txtStateName').val(State);
        $('#txtZipCode').val(ZipCode);
        $('#txtStreetName').val(Street);
        $('#btnclientsubmit').text('Update');
        $("html, body").animate({ scrollTop: 0 }, "slow");
    }
    function GAUSerEdit(SubBrokerId, FirstName, LastName, Email, WorkPhone, Phone) {
        $('#ddlAdAdministratorType1').val(SubBrokerId);
        $('#txtAdFirstName1').val(FirstName);
        $('#txtAdLastName1').val(LastName);
        $('#txtAdEmail1').val(Email);
        $('#txtAdWorkPhone1').val(WorkPhone);
        $('#txtAdMobile1').val(Phone);
        $('#btnclientsubmit1').text('Update');
        $("html, body").animate({ scrollTop: $("#scrolltop").position().top }, "slow");
    }

</script>
